<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.awethumb.repository.dao.StatsDAO">
    <!-- 세션에서 자동으로 방문자수 추가 -->
    <insert id="insertVisitCount" parameterType="VisitCount">
            INSERT
            INTO visitor_tb
            (
                visit_ip,
                visit_refer,
                visit_agent
            )
            VALUES
            (
                #{visitIp},
                #{visitRefer},
                #{visitAgent}
            )
        </insert>
    <!-- 오늘 총방문자수 셀렉 -->
    <select id="totalVisitToday" resultType="int">
		select count(*)
		  from visitor_tb
		 where LEFT(visit_time, 10) IN (LEFT(NOW(),10))
	</select>
	<!-- 오늘 작성된 총글수 셀렉 -->
	<select id="totalPostToday" resultType="int">
		select count(*)
		  from board_tb
		 where LEFT(reg_date, 10) IN (LEFT(NOW(),10))
	</select>
 	<!-- 오늘 총 글 조회수 셀렉 -->
<!-- 	<select id="totalViewCntToday" resultType="int"> -->
<!-- 		select sum() -->
<!-- 		  from board_tb -->
<!-- 		 where LEFT(join_dt, 10) IN (LEFT(NOW(),10)) -->
<!-- 	</select> -->
	<!-- 오늘 가입한 총 회원수 셀렉 -->
	<select id="totalUserToday" resultType="int">
		select count(*)
		  from user_tb
		 where LEFT(join_dt, 10) IN (LEFT(NOW(),10))
	</select>
	
	<!-- 방문자 발생시 일일 로그의 방문자수 업데이트 -->
	<update id="dailyVisitUpdate">
		update daily_log_tb
		   set daily_visit_cnt = daily_visit_cnt + 1
		 where LEFT(log_dt, 10) IN (LEFT(NOW(), 10))
	</update>
	<!-- 회원가입 발생시 일일 로그의 가입자수 업데이트 -->
	<update id="dailyJoinUpdate">
		update daily_log_tb
		   set daily_join_cnt = daily_join_cnt + 1
		 where LEFT(log_dt, 10) IN (LEFT(NOW(), 10))
	</update>
	<!-- 포스트 조회수 증가 발생시 일일 로그의 방문자수 업데이트 -->
	<update id="dailyViewUpdate">
		update daily_log_tb
		   set daily_view_cnt = daily_view_cnt + 1
		 where LEFT(log_dt, 10) IN (LEFT(NOW(), 10))
	</update>
	<!-- 포스트 글작성 발생시 일일 로그의 방문자수 업데이트 -->
	<update id="dailyPostUpdate">
		update daily_log_tb
		   set daily_post_cnt = daily_post_cnt + 1
		 where LEFT(log_dt, 10) IN (LEFT(NOW(), 10))
	</update>
	
	
	<!-- 데일리 로그 1달 셀렉 -->
	<select id="selectDailyLogOneMonth" resultType="DailyLog">
		select *
		  from daily_log_tb
	  order by log_dt desc
	  limit 0, 30
	</select>
	
	<!-- 검색이 일어날시 검색로그테이블에 데이터 삽입 -->
	<insert id="insertSearchLog" parameterType="string">
		insert into search_log_tb (search_keyword) values (#{searchKeyword})
	</insert>
	
		
</mapper>